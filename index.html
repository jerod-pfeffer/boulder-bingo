<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Boulder Bingo</title>
  <!-- iOS home‚Äëscreen app behavior -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Boulder Bingo" />

  <!-- App icon for iOS add‚Äëto‚Äëhome‚Äëscreen (embedded SVG as PNG via data URI works) -->
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23A7F3D0'/%3E%3Cstop offset='1' stop-color='%2310B981'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='96' fill='url(%23g)'/%3E%3Cg fill='%2300653C'%3E%3Cpath d='M154 350c-18-24 4-50 24-63l76-48 36-80c10-23 32-30 43-25 11 5 20 22 10 45l-36 80 44 73c14 23 0 47-20 52s-38-5-49-23l-28-44-54 35c-27 16-52 17-46-2z'/%3E%3Ctext x='256' y='456' font-family='Arial, Helvetica, sans-serif' font-weight='700' font-size='96' text-anchor='middle'%3EBB%3C/text%3E%3C/g%3E%3C/svg%3E" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ccircle cx='64' cy='64' r='60' fill='%2310B981'/%3E%3Ctext x='64' y='84' font-family='Arial' font-weight='700' font-size='72' text-anchor='middle' fill='%2303120d'%3EB%3C/text%3E%3C/svg%3E" />
  <meta name="theme-color" content="#0b0f12" />

  <style>
    :root { --bg:#0b0f12; --panel:#11161b; --ink:#e8f0f3; --muted:#a6b3bb; --accent:#59d9a7; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font:16px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;}
    .wrap{min-height:100%; padding: env(safe-area-inset-top) 16px calc(24px + env(safe-area-inset-bottom)); display:grid; grid-template-rows:auto 1fr auto; gap:16px; max-width:880px; margin:0 auto}
    header{display:flex; align-items:center; justify-content:space-between; padding-top:10px}
    h1{font-size:28px; margin:0; letter-spacing:0.3px}
    .badge{font-size:12px; color:var(--muted)}
    .card{background:var(--panel); border-radius:20px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.35);}
    .display{font-size:28px; line-height:1.3; min-height:4.5lh; display:flex; align-items:center; justify-content:center; text-align:center; padding:24px; border:1px dashed #2a3138; border-radius:16px}
    .display .icon{width:28px; height:28px; margin-right:10px; opacity:.9}
    .controls{display:flex; gap:12px; flex-wrap:wrap; margin-top:16px}
    button{appearance:none; border:none; border-radius:14px; padding:14px 18px; font-weight:700; font-size:16px; color:#07110d; background:var(--accent); cursor:pointer; box-shadow:0 6px 16px rgba(16,185,129,.35);}
    button.secondary{background:#24313a; color:var(--ink); box-shadow:none; border:1px solid #2b3a44}
    button.ghost{background:transparent; color:var(--muted); border:1px solid #2b3a44}
    .stack{display:flex; flex-direction:column; gap:12px}
    .history{max-height:210px; overflow:auto; padding-right:6px}
    .history h3{margin:0 0 6px 0; color:var(--muted); font-size:13px; font-weight:600; letter-spacing:.3px}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; background:#1a2228; border:1px solid #2b3a44; border-radius:999px; margin:6px 6px 0 0; font-size:14px}
    .pill svg{width:18px; height:18px; opacity:.9}
    details{background:var(--panel); border-radius:20px; padding:16px 16px 6px; border:1px solid #1c242a}
    details summary{cursor:pointer; color:var(--muted); margin-bottom:12px}
    textarea{width:100%; min-height:140px; resize:vertical; border-radius:12px; border:1px solid #2b3a44; background:#0e1317; color:var(--ink); padding:12px}
    .hint{color:var(--muted); font-size:12px}
    footer{color:var(--muted); font-size:12px; text-align:center}
    .toggle{display:flex; align-items:center; gap:10px; font-size:14px; color:var(--muted)}
    .toggle input{transform:scale(1.2)}

    /* Bingo cards */
    .bingo-controls{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .bingo-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px}
    .card3{background:white; color:#0b0f12; border-radius:16px; padding:14px; border:3px solid #0b0f12}
    .card3 h4{margin:0 0 8px 0; font-size:14px; letter-spacing:.3px}
    .slots{display:grid; grid-template-columns:1fr; gap:8px}
    .slot{border:2px dashed #2c2c2c; border-radius:12px; padding:14px; min-height:56px; display:flex; align-items:center; justify-content:center; text-align:center; font-weight:700}
    .slot .mini{width:18px; height:18px; margin-right:8px}

    /* Print layout */
    @media print{
      body{background:white; color:black}
      .wrap{padding:0}
      header, details, footer, .history, .main-controls{display:none !important}
      .bingo-grid{grid-template-columns:repeat(3, 1fr); gap:16px}
      .card3{page-break-inside:avoid}
    }
  </style>
</head>
<body>
  <!-- Tiny inline SVG icon set -->
  <svg width="0" height="0" style="position:absolute;opacity:0;pointer-events:none" aria-hidden="true">
    <symbol id="ic-press" viewBox="0 0 24 24"><path fill="currentColor" d="M3 21h18v-2H3v2zm9-18a5 5 0 00-5 5v4H5l7 7 7-7h-2V8a5 5 0 00-5-5z"/></symbol>
    <symbol id="ic-mantle" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20h16l-8-16-8 16z"/></symbol>
    <symbol id="ic-gaston" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2l4 4-4 4-4-4 4-4zm-6 12l4 4-4 4-4-4 4-4zm12 0l4 4-4 4-4-4 4-4z"/></symbol>
    <symbol id="ic-flag" viewBox="0 0 24 24"><path fill="currentColor" d="M6 2v20H4V2h2zm2 0h10l-2 4 2 4H8V2z"/></symbol>
    <symbol id="ic-deadpoint" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2l6 10h-4v10h-4V12H6l6-10z"/></symbol>
    <symbol id="ic-highstep" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20h16v-2H10v-4h6v-2h-6v-4h10V6H4v14z"/></symbol>
    <symbol id="ic-rose" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2c3 0 5 2 5 5s-2 5-5 5-5-2-5-5 2-5 5-5zm-5 11h10l-5 9-5-9z"/></symbol>
    <symbol id="ic-dyno" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20l8-8 4 4 4-10-10 4 4 4-8 6z"/></symbol>
    <symbol id="ic-static" viewBox="0 0 24 24"><path fill="currentColor" d="M4 12h16v2H4z"/></symbol>
    <symbol id="ic-heel" viewBox="0 0 24 24"><path fill="currentColor" d="M3 17c0-3 4-6 9-6s9 3 9 6-4 3-9 3-9 0-9-3zm6-9l3-3 3 3-3 3-3-3z"/></symbol>
    <symbol id="ic-lache" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2l6 6-6 6-6-6 6-6zm0 14v6h-2v-6h2z"/></symbol>
    <symbol id="ic-generic" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="currentColor"/></symbol>
  </svg>

  <div class="wrap">
    <header>
      <h1>üßó‚Äç‚ôÄÔ∏è Boulder Bingo</h1>
      <span class="badge" id="countBadge">0 drawn</span>
    </header>

    <main class="card">
      <div class="stack main-controls">
        <div class="display" id="current">Tap GO! to draw a movement.</div>
        <div class="controls">
          <button id="goBtn" aria-label="Draw movement">GO!</button>
          <button id="resetBtn" class="secondary" aria-label="Reset list">Reset</button>
          <button id="copyBtn" class="ghost" aria-label="Copy current to clipboard">Copy</button>
        </div>
        <label class="toggle"><input type="checkbox" id="noRepeat" checked /> No repeats until reset</label>
      </div>
    </main>

    <section class="card history">
      <h3>History</h3>
      <div id="historyList"></div>
    </section>

    <section class="card">
      <h3 style="margin-top:0">Bingo card generator (3 words per card)</h3>
      <div class="bingo-controls">
        <label>Cards: <input id="numCards" type="number" min="1" max="60" value="9" style="width:80px; padding:8px; border-radius:10px; border:1px solid #2b3a44; background:#0e1317; color:var(--ink)"></label>
        <button id="genCards">Generate</button>
        <button id="printCards" class="secondary">Print</button>
        <label class="toggle"><input type="checkbox" id="uniqueAcross"/> Avoid repeats across all cards</label>
      </div>
      <div class="bingo-grid" id="cardsGrid" style="margin-top:12px"></div>
    </section>

    <details>
      <summary>Customize word list</summary>
      <div class="stack">
        <textarea id="listArea" spellcheck="false"></textarea>
        <div class="controls">
          <button id="saveList">Save List</button>
          <button id="restoreList" class="secondary">Restore Default</button>
          <span class="hint">One item per line. Saved to this device only.</span>
        </div>
      </div>
    </details>

    <footer>
      Tip: In Safari, share ‚ûú <strong>Add to Home Screen</strong> to run fullscreen.
    </footer>
  </div>

  <script>
    // Default movements (you can edit these below in the UI)
    const DEFAULT_WORDS = [
      'press','mantle','gaston','back flag','flag',
      'left hand deadpoint','right hand deadpoint',
      'left foot high step','right foot high step',
      'rose move','double dyno',
      'extra long static left hand','extra long static right hand',
      'right foot heel hook on tiny hold','left foot heel hook on tiny hold',
      'right foot heel hook above head','left foot heel hook above head',
      'lache'
    ];

    const KEY_STORAGE = 'boulder-bingo-words-v1';
    const KEY_HISTORY = 'boulder-bingo-history-v1';
    const KEY_NOREPEAT = 'boulder-bingo-norepeat-v1';

    const currentEl = document.getElementById('current');
    const historyEl = document.getElementById('historyList');
    const countBadge = document.getElementById('countBadge');
    const goBtn = document.getElementById('goBtn');
    const resetBtn = document.getElementById('resetBtn');
    const copyBtn = document.getElementById('copyBtn');
    const listArea = document.getElementById('listArea');
    const saveListBtn = document.getElementById('saveList');
    const restoreBtn = document.getElementById('restoreList');
    const noRepeat = document.getElementById('noRepeat');

    // Bingo controls
    const numCards = document.getElementById('numCards');
    const genCards = document.getElementById('genCards');
    const printCards = document.getElementById('printCards');
    const cardsGrid = document.getElementById('cardsGrid');
    const uniqueAcross = document.getElementById('uniqueAcross');

    // Icon mapping by keyword (very lightweight & forgiving)
    const ICONS = [
      {keys:['press'], id:'ic-press'},
      {keys:['mantle'], id:'ic-mantle'},
      {keys:['gaston'], id:'ic-gaston'},
      {keys:['back flag','flag'], id:'ic-flag'},
      {keys:['deadpoint'], id:'ic-deadpoint'},
      {keys:['high step'], id:'ic-highstep'},
      {keys:['rose'], id:'ic-rose'},
      {keys:['dyno'], id:'ic-dyno'},
      {keys:['static'], id:'ic-static'},
      {keys:['heel hook'], id:'ic-heel'},
      {keys:['lache','latch'], id:'ic-lache'}
    ];

    const iconFor = (word) => {
      const w = word.toLowerCase();
      const m = ICONS.find(obj => obj.keys.some(k => w.includes(k)));
      return m ? m.id : 'ic-generic';
    };

    // Load / init state
    const loadWords = () => {
      const saved = localStorage.getItem(KEY_STORAGE);
      return saved ? JSON.parse(saved) : DEFAULT_WORDS.slice();
    };
    const saveWords = (arr) => localStorage.setItem(KEY_STORAGE, JSON.stringify(arr));
    const loadHistory = () => { try { return JSON.parse(localStorage.getItem(KEY_HISTORY)) || []; } catch { return []; } };
    const saveHistory = (arr) => localStorage.setItem(KEY_HISTORY, JSON.stringify(arr));
    const setNoRepeat = (v) => localStorage.setItem(KEY_NOREPEAT, v ? '1':'0');
    const getNoRepeat = () => localStorage.getItem(KEY_NOREPEAT) !== '0';

    let words = loadWords();
    let history = loadHistory();
    noRepeat.checked = getNoRepeat();

    const renderHistory = () => {
      countBadge.textContent = `${history.length} drawn`;
      historyEl.innerHTML = history.map((w,i)=>`<span class="pill" title="${i+1}"><svg><use href="#${iconFor(w)}"/></svg>${w} <small>#${i+1}</small></span>`).join('');
    };

    const renderCurrent = (text) => {
      currentEl.innerHTML = `<svg class="icon"><use href="#${iconFor(text)}"/></svg>${text}`;
    };

    const randomPick = () => {
      const pool = noRepeat.checked ? words.filter(w => !history.includes(w)) : words.slice();
      if (pool.length === 0) return null;
      return pool[Math.floor(Math.random()*pool.length)];
    };

    const draw = () => {
      const pick = randomPick();
      if (!pick) {
        currentEl.textContent = 'All items used ‚Äî tap Reset or disable no‚Äërepeats.';
        return;
      }
      renderCurrent(pick);
      history.unshift(pick);
      saveHistory(history);
      renderHistory();
      if (window.navigator && 'vibrate' in window.navigator) navigator.vibrate(10);
    };

    const reset = () => {
      history = [];
      saveHistory(history);
      currentEl.textContent = 'List reset. Tap GO!';
      renderHistory();
    };

    // Bingo logic (3 words per card)
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
      return a;
    }

    function pickN(source, n){
      const pool = shuffle(source);
      return pool.slice(0, n);
    }

    function generateCards(){
      const n = Math.max(1, Math.min(60, parseInt(numCards.value||'9',10)));
      const w = words.slice();
      const all = [];
      let cursor = 0;
      for(let i=0;i<n;i++){
        let card;
        if (uniqueAcross.checked){
          // ensure no repeats across all cards until words exhausted
          if (cursor + 3 > w.length){
            // reshuffle when exhausted
            cursor = 0; w.sort(()=>Math.random()-0.5);
          }
          card = w.slice(cursor, cursor+3);
          cursor += 3;
        } else {
          card = pickN(w, 3);
        }
        all.push(card);
      }
      renderCards(all);
    }

    function renderCards(list){
      cardsGrid.innerHTML = list.map((card, idx)=>{
        const slots = card.map(item=>`<div class="slot"><svg class="mini"><use href="#${iconFor(item)}"/></svg>${item}</div>`).join('');
        return `<div class="card3"><h4>Boulder Bingo ‚Äî Card ${idx+1}</h4><div class="slots">${slots}</div></div>`;
      }).join('');
    }

    // Event wiring
    goBtn.addEventListener('click', draw);
    resetBtn.addEventListener('click', reset);
    copyBtn.addEventListener('click', () => {
      const text = currentEl.textContent.trim();
      if (!text || text.startsWith('Tap GO') || text.startsWith('All items')) return;
      navigator.clipboard?.writeText(text);
      copyBtn.textContent = 'Copied!';
      setTimeout(()=>copyBtn.textContent='Copy', 900);
    });

    saveListBtn.addEventListener('click', () => {
      const lines = listArea.value.split(/\n+/).map(s=>s.trim()).filter(Boolean);
      if (lines.length === 0) return;
      words = Array.from(new Set(lines));
      saveWords(words);
      reset();
      saveListBtn.textContent = 'Saved ‚úì';
      setTimeout(()=>saveListBtn.textContent='Save List', 900);
    });

    restoreBtn.addEventListener('click', () => {
      words = DEFAULT_WORDS.slice();
      saveWords(words);
      listArea.value = words.join('\n');
      reset();
    });

    noRepeat.addEventListener('change', (e)=> setNoRepeat(e.target.checked));

    genCards.addEventListener('click', generateCards);
    printCards.addEventListener('click', ()=> window.print());

    // First paint
    listArea.value = words.join('\n');
    renderHistory();
  </script>
</body>
</html>
