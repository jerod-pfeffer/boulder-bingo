<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Boulder Bingo</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Boulder Bingo" />
  <style>
    :root { --bg:#0b0f12; --panel:#11161b; --ink:#e8f0f3; --muted:#a6b3bb; --accent:#59d9a7; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font:16px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;}
    .wrap{min-height:100%; padding:16px; display:grid; grid-template-rows:auto 1fr auto; gap:16px; max-width:880px; margin:0 auto}
    header{display:flex; align-items:center; justify-content:space-between; padding-top:10px}
    h1{font-size:28px; margin:0; letter-spacing:0.3px}
    .badge{font-size:12px; color:var(--muted)}
    .card{background:var(--panel); border-radius:20px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.35);}
    .display{font-size:28px; line-height:1.3; min-height:4.5lh; display:flex; align-items:center; justify-content:center; text-align:center; padding:24px; border:1px dashed #2a3138; border-radius:16px}
    .controls{display:flex; gap:12px; flex-wrap:wrap; margin-top:16px}
    button{appearance:none; border:none; border-radius:14px; padding:14px 18px; font-weight:700; font-size:16px; color:#07110d; background:var(--accent); cursor:pointer; box-shadow:0 6px 16px rgba(16,185,129,.35);}
    button.secondary{background:#24313a; color:var(--ink); box-shadow:none; border:1px solid #2b3a44}
    button.ghost{background:transparent; color:var(--muted); border:1px solid #2b3a44}
    .stack{display:flex; flex-direction:column; gap:12px}
    .history{max-height:210px; overflow:auto; padding-right:6px}
    .history h3{margin:0 0 6px 0; color:var(--muted); font-size:13px; font-weight:600; letter-spacing:.3px}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; background:#1a2228; border:1px solid #2b3a44; border-radius:999px; margin:6px 6px 0 0; font-size:14px}
    details{background:var(--panel); border-radius:20px; padding:16px 16px 6px; border:1px solid #1c242a}
    details summary{cursor:pointer; color:var(--muted); margin-bottom:12px}
    textarea{width:100%; min-height:140px; resize:vertical; border-radius:12px; border:1px solid #2b3a44; background:#0e1317; color:var(--ink); padding:12px}
    .hint{color:var(--muted); font-size:12px}
    .toggle{display:flex; align-items:center; gap:10px; font-size:14px; color:var(--muted)}
    .toggle input{transform:scale(1.2)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üßó‚Äç‚ôÄÔ∏è Boulder Bingo</h1>
      <span class="badge" id="countBadge">0 drawn</span>
    </header>

    <main class="card">
      <div class="stack main-controls">
        <div class="display" id="current">Tap GO! to draw movements.</div>
        <div class="controls">
          <button id="goBtn">GO!</button>
          <button id="resetBtn" class="secondary">Reset</button>
          <button id="copyBtn" class="ghost">Copy</button>
        </div>
        <label class="toggle"><input type="checkbox" id="noRepeat" checked /> No repeats until reset</label>
      </div>
    </main>

    <section class="card history">
      <h3>History</h3>
      <div id="historyList"></div>
    </section>

    <details>
      <summary>Customize word list</summary>
      <div class="stack">
        <textarea id="listArea" spellcheck="false"></textarea>
        <div class="controls">
          <button id="saveList">Save List</button>
          <button id="restoreList" class="secondary">Restore Default</button>
          <span class="hint">One item per line. Saved to this device only.</span>
        </div>
      </div>
    </details>
  </div>

  <script>
    const DEFAULT_WORDS = [
      'press','mantle','gaston','back flag','flag',
      'left hand deadpoint','right hand deadpoint',
      'left foot high step','right foot high step',
      'rose move','double dyno',
      'extra long static left hand','extra long static right hand',
      'right foot heel hook on tiny hold','left foot heel hook on tiny hold',
      'right foot heel hook above head','left foot heel hook above head',
      'lache'
    ];

    const KEY_STORAGE = 'boulder-bingo-words-v1';
    const KEY_HISTORY = 'boulder-bingo-history-v1';
    const KEY_NOREPEAT = 'boulder-bingo-norepeat-v1';

    const currentEl = document.getElementById('current');
    const historyEl = document.getElementById('historyList');
    const countBadge = document.getElementById('countBadge');
    const goBtn = document.getElementById('goBtn');
    const resetBtn = document.getElementById('resetBtn');
    const copyBtn = document.getElementById('copyBtn');
    const listArea = document.getElementById('listArea');
    const saveListBtn = document.getElementById('saveList');
    const restoreBtn = document.getElementById('restoreList');
    const noRepeat = document.getElementById('noRepeat');

    const loadWords = () => {
      const saved = localStorage.getItem(KEY_STORAGE);
      return saved ? JSON.parse(saved) : DEFAULT_WORDS.slice();
    };
    const saveWords = (arr) => localStorage.setItem(KEY_STORAGE, JSON.stringify(arr));
    const loadHistory = () => { try { return JSON.parse(localStorage.getItem(KEY_HISTORY)) || []; } catch { return []; } };
    const saveHistory = (arr) => localStorage.setItem(KEY_HISTORY, JSON.stringify(arr));
    const setNoRepeat = (v) => localStorage.setItem(KEY_NOREPEAT, v ? '1':'0');
    const getNoRepeat = () => localStorage.getItem(KEY_NOREPEAT) !== '0';

    let words = loadWords();
    let history = loadHistory();
    noRepeat.checked = getNoRepeat();

    const renderHistory = () => {
      countBadge.textContent = `${history.length} drawn`;
      historyEl.innerHTML = history.map((w,i)=>`<span class="pill">${w} <small>#${i+1}</small></span>`).join('');
    };

    const randomPick = () => {
      const pool = noRepeat.checked ? words.filter(w => !history.includes(w)) : words.slice();
      if (pool.length < 2) return null;
      const pick1 = pool.splice(Math.floor(Math.random()*pool.length),1)[0];
      const pick2 = pool[Math.floor(Math.random()*pool.length)];
      return [pick1, pick2];
    };

    const draw = () => {
      const picks = randomPick();
      if (!picks) {
        currentEl.textContent = 'Not enough items ‚Äî tap Reset or disable no‚Äërepeats.';
        return;
      }
      currentEl.textContent = `${picks[0]}  |  ${picks[1]}`;
      history.unshift(`${picks[0]}  |  ${picks[1]}`);
      saveHistory(history);
      renderHistory();
      if (window.navigator && 'vibrate' in window.navigator) navigator.vibrate(10);
    };

    const reset = () => {
      history = [];
      saveHistory(history);
      currentEl.textContent = 'List reset. Tap GO!';
      renderHistory();
    };

    goBtn.addEventListener('click', draw);
    resetBtn.addEventListener('click', reset);
    copyBtn.addEventListener('click', () => {
      const text = currentEl.textContent.trim();
      if (!text || text.startsWith('Tap GO') || text.startsWith('Not enough')) return;
      navigator.clipboard?.writeText(text);
      copyBtn.textContent = 'Copied!';
      setTimeout(()=>copyBtn.textContent='Copy', 900);
    });

    saveListBtn.addEventListener('click', () => {
      const lines = listArea.value.split(/\n+/).map(s=>s.trim()).filter(Boolean);
      if (lines.length === 0) return;
      words = Array.from(new Set(lines));
      saveWords(words);
      reset();
      saveListBtn.textContent = 'Saved ‚úì';
      setTimeout(()=>saveListBtn.textContent='Save List', 900);
    });

    restoreBtn.addEventListener('click', () => {
      words = DEFAULT_WORDS.slice();
      saveWords(words);
      listArea.value = words.join('\n');
      reset();
    });

    noRepeat.addEventListener('change', (e)=> setNoRepeat(e.target.checked));

    listArea.value = words.join('\n');
    renderHistory();
  </script>
</body>
</html>
