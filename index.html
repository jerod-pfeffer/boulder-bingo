<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Boulder Bingo</title>
<style>
  :root {
    --bg: #0b0f12;
    --panel: #11161b;
    --ink: #e8f0f3;
    --muted: #a6b3bb;
    --accent: #59d9a7;
  }
  body {
    margin: 0;
    background: var(--bg);
    color: var(--ink);
    font: 16px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    justify-content: center;
    padding: 20px;
  }
  .wrap { max-width: 640px; width: 100%; }
  h1 { font-size: 28px; margin: 0 0 20px; text-align: center; }
  .card {
    background: var(--panel);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
    margin-bottom: 16px;
  }
  .display {
    font-size: 28px;
    line-height: 1.3;
    min-height: 4.5lh;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 24px;
    border: 1px dashed #2a3138;
    border-radius: 16px;
    margin-bottom: 20px;
  }
  .go-btn {
    width: 100%;
    padding: 20px;
    font-size: 22px;
    font-weight: 700;
    background: var(--accent);
    color: #07110d;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    box-shadow: 0 6px 16px rgba(16,185,129,.35);
  }
  .controls {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 16px;
  }
  .controls button {
    flex: 1;
    padding: 12px;
    font-size: 16px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
  }
  .secondary { background: #24313a; color: var(--ink); border: 1px solid #2b3a44; }
  .ghost { background: transparent; color: var(--muted); border: 1px solid #2b3a44; }
  .history h3 { margin: 0 0 10px; }
  .pair { display: inline-block; padding: 8px 12px; background: #1a2228; border: 1px solid #2b3a44; border-radius: 999px; margin: 6px 6px 0 0; font-size: 14px; }
  details summary { cursor: pointer; color: var(--muted); font-weight: 600; }
  textarea {
    width: 100%;
    min-height: 160px;
    resize: vertical;
    border-radius: 12px;
    border: 1px solid #2b3a44;
    background: #0e1317;
    color: var(--ink);
    padding: 12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  }
  .small-controls { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
  .small-controls button { padding: 10px 14px; border-radius: 10px; border: 1px solid #2b3a44; background: #24313a; color: var(--ink); cursor: pointer; }
  .hint { color: var(--muted); font-size: 12px; margin-left: 8px; }
</style>
</head>
<body>
<div class="wrap">
  <h1>üßó‚Äç‚ôÄÔ∏è Boulder Bingo</h1>

  <div class="card">
    <div class="display" id="current">Tap GO! to draw two movements.</div>
    <button id="goBtn" class="go-btn">GO!</button>
    <div class="controls">
      <button id="copyBtn" class="ghost">Copy</button>
      <button id="resetBtn" class="secondary">Reset</button>
    </div>
  </div>

  <div class="card history">
    <h3>History</h3>
    <div id="historyList"></div>
  </div>

  <details class="card">
    <summary>Edit word list</summary>
    <p class="hint">One item per line. Changes are saved to this device only.</p>
    <textarea id="listArea" spellcheck="false"></textarea>
    <div class="small-controls">
      <button id="saveList">Save List</button>
      <button id="restoreList">Restore Default</button>
      <span class="hint" id="saveHint"></span>
    </div>
  </details>
</div>

<script>
  // ---------- Config & Storage Keys ----------
  const DEFAULT_WORDS = [
    'press','mantle','gaston','back flag','flag',
    'left hand deadpoint','right hand deadpoint',
    'left foot high step','right foot high step',
    'rose move','double dyno',
    'extra long static left hand','extra long static right hand',
    'right foot heel hook on tiny hold','left foot heel hook on tiny hold',
    'right foot heel hook above head','left foot heel hook above head',
    'lache'
  ];
  const KEY_WORDS   = 'bb_words_v3';
  const KEY_USED    = 'bb_used_v3';        // Set of already drawn single words
  const KEY_PAIRS   = 'bb_pairs_v3';       // Display history of pairs (strings like "A + B")

  // ---------- DOM ----------
  const currentEl   = document.getElementById('current');
  const goBtn       = document.getElementById('goBtn');
  const resetBtn    = document.getElementById('resetBtn');
  const copyBtn     = document.getElementById('copyBtn');
  const historyEl   = document.getElementById('historyList');
  const listArea    = document.getElementById('listArea');
  const saveListBtn = document.getElementById('saveList');
  const restoreBtn  = document.getElementById('restoreList');
  const saveHint    = document.getElementById('saveHint');

  // ---------- Helpers ----------
  const loadWords = () => {
    const saved = localStorage.getItem(KEY_WORDS);
    return saved ? JSON.parse(saved) : DEFAULT_WORDS.slice();
  };
  const saveWords = (arr) => localStorage.setItem(KEY_WORDS, JSON.stringify(arr));

  const loadUsed = () => {
    try { return new Set(JSON.parse(localStorage.getItem(KEY_USED)) || []); }
    catch { return new Set(); }
  };
  const saveUsed = (set) => localStorage.setItem(KEY_USED, JSON.stringify([...set]));

  const loadPairs = () => {
    try { return JSON.parse(localStorage.getItem(KEY_PAIRS)) || []; }
    catch { return []; }
  };
  const savePairs = (pairs) => localStorage.setItem(KEY_PAIRS, JSON.stringify(pairs));

  const shuffle = (arr) => {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  };

  // ---------- State ----------
  let words = loadWords();
  let used = loadUsed();     // tracks no-repeat across individual words
  let pairs = loadPairs();   // history of pairs (strings)

  // ---------- UI Renderers ----------
  const renderPairs = () => {
    historyEl.innerHTML = pairs.map(p => `<span class="pair">${p}</span>`).join('');
  };

  const setCurrent = (text) => {
    currentEl.textContent = text;
  };

  // ---------- Draw Logic (two words, no repeats until reset) ----------
  const drawTwo = () => {
    const pool = words.filter(w => !used.has(w));
    if (pool.length < 2) {
      setCurrent('Not enough unused words ‚Äî add more or Reset.');
      return;
    }
    const [a, b] = shuffle(pool).slice(0, 2);
    const line = `${a} + ${b}`;
    setCurrent(line);
    pairs.unshift(`${a} + ${b}`);
    savePairs(pairs);
    used.add(a); used.add(b);
    saveUsed(used);
    renderPairs();
    if ('vibrate' in navigator) navigator.vibrate(10);
  };

  const resetAll = () => {
    used = new Set();
    pairs = [];
    saveUsed(used);
    savePairs(pairs);
    setCurrent('List reset. Tap GO!');
    renderPairs();
  };

  // ---------- Editor ----------
  const hydrateEditor = () => {
    listArea.value = words.join('\n');
  };

  const saveList = () => {
    const lines = listArea.value
      .split(/\n+/)
      .map(s => s.trim())
      .filter(Boolean);
    if (!lines.length) return;
    // Deduplicate while preserving order
    const seen = new Set();
    const deduped = [];
    for (const w of lines) {
      if (!seen.has(w)) { seen.add(w); deduped.push(w); }
    }
    words = deduped;
    saveWords(words);
    // When the list changes, clear used/pairs to keep no-repeat consistent
    resetAll();
    flashSaveHint('Saved ‚úì');
  };

  const restoreDefaults = () => {
    words = DEFAULT_WORDS.slice();
    saveWords(words);
    hydrateEditor();
    resetAll();
    flashSaveHint('Restored ‚úì');
  };

  const flashSaveHint = (msg) => {
    saveHint.textContent = msg;
    setTimeout(() => (saveHint.textContent = ''), 900);
  };

  // ---------- Wire Up ----------
  goBtn.addEventListener('click', drawTwo);
  resetBtn.addEventListener('click', resetAll);
  copyBtn.addEventListener('click', () => {
    const text = currentEl.textContent.trim();
    if (!text || text.startsWith('Tap GO') || text.startsWith('Not enough')) return;
    navigator.clipboard?.writeText(text);
    copyBtn.textContent = 'Copied!';
    setTimeout(() => (copyBtn.textContent = 'Copy'), 900);
  });

  saveListBtn.addEventListener('click', saveList);
  restoreBtn.addEventListener('click', restoreDefaults);

  // ---------- First Paint ----------
  hydrateEditor();
  renderPairs();
  setCurrent('Tap GO! to draw two movements.');
</script>
</body>
</html>
